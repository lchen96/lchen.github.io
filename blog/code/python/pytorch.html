<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>pytorch | Lei Chen&#39;s Homepage</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/img/disc_favicon.ico">
    <meta name="description" content="">
    
    <link rel="preload" href="/assets/css/0.styles.68111185.css" as="style"><link rel="preload" href="/assets/js/app.e19d5aed.js" as="script"><link rel="preload" href="/assets/js/2.a3bd5069.js" as="script"><link rel="preload" href="/assets/js/19.a888442d.js" as="script"><link rel="prefetch" href="/assets/js/10.ff64dcfd.js"><link rel="prefetch" href="/assets/js/11.abcc6822.js"><link rel="prefetch" href="/assets/js/12.15624b80.js"><link rel="prefetch" href="/assets/js/13.8227123f.js"><link rel="prefetch" href="/assets/js/14.d39479a5.js"><link rel="prefetch" href="/assets/js/15.fc5579cb.js"><link rel="prefetch" href="/assets/js/16.40cfa9cb.js"><link rel="prefetch" href="/assets/js/17.59f44fa4.js"><link rel="prefetch" href="/assets/js/18.e2fff532.js"><link rel="prefetch" href="/assets/js/20.b4b095c5.js"><link rel="prefetch" href="/assets/js/21.3b0f9f6b.js"><link rel="prefetch" href="/assets/js/22.3dcf4f9f.js"><link rel="prefetch" href="/assets/js/23.62bed7a8.js"><link rel="prefetch" href="/assets/js/24.3f827dd3.js"><link rel="prefetch" href="/assets/js/25.d22ad365.js"><link rel="prefetch" href="/assets/js/3.9c502e1c.js"><link rel="prefetch" href="/assets/js/4.1c712331.js"><link rel="prefetch" href="/assets/js/5.ad171e62.js"><link rel="prefetch" href="/assets/js/6.0afe8710.js"><link rel="prefetch" href="/assets/js/7.54991339.js"><link rel="prefetch" href="/assets/js/8.0cf19c90.js"><link rel="prefetch" href="/assets/js/9.7740fafc.js">
    <link rel="stylesheet" href="/assets/css/0.styles.68111185.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/disc_favicon.ico" alt="Lei Chen's Homepage" class="logo"> <span class="site-name can-hide">Lei Chen's Homepage</span></a> <div class="links"><!----> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/projects/" class="nav-link">
  Projects
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Blog" class="dropdown-title"><span class="title">Blog</span> <span class="arrow down"></span></button> <button type="button" aria-label="Blog" class="mobile-dropdown-title"><span class="title">Blog</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/papershare/" class="nav-link">
  Paper Sharing
</a></li><li class="dropdown-item"><!----> <a href="/blog/note/" class="nav-link">
  Notes
</a></li><li class="dropdown-item"><!----> <a href="/blog/code/" class="nav-link router-link-active">
  Code
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/projects/" class="nav-link">
  Projects
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Blog" class="dropdown-title"><span class="title">Blog</span> <span class="arrow down"></span></button> <button type="button" aria-label="Blog" class="mobile-dropdown-title"><span class="title">Blog</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/papershare/" class="nav-link">
  Paper Sharing
</a></li><li class="dropdown-item"><!----> <a href="/blog/note/" class="nav-link">
  Notes
</a></li><li class="dropdown-item"><!----> <a href="/blog/code/" class="nav-link router-link-active">
  Code
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><a href="/blog/code/python/" class="sidebar-heading clickable router-link-active open"><span>python</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/code/python/packages.html" class="sidebar-link">packages</a></li><li><a href="/blog/code/python/pytorch.html" aria-current="page" class="active sidebar-link">pytorch</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/code/python/pytorch.html#张量初始化及转换" class="sidebar-link">张量初始化及转换</a></li><li class="sidebar-sub-header"><a href="/blog/code/python/pytorch.html#张量基本运算" class="sidebar-link">张量基本运算</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/code/python/pytorch.html#基本运算" class="sidebar-link">基本运算</a></li><li class="sidebar-sub-header"><a href="/blog/code/python/pytorch.html#乘法进阶-mm-mat" class="sidebar-link">乘法进阶 mm mat</a></li><li class="sidebar-sub-header"><a href="/blog/code/python/pytorch.html#聚合-max-min-mean" class="sidebar-link">聚合 max min mean</a></li><li class="sidebar-sub-header"><a href="/blog/code/python/pytorch.html#拼接-切分-cat-stack-chunk-split" class="sidebar-link">拼接/切分 cat stack chunk split</a></li><li class="sidebar-sub-header"><a href="/blog/code/python/pytorch.html#形状转换-squeeze-view-transpose-permute-pad" class="sidebar-link">形状转换 squeeze view transpose permute pad</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/code/python/pytorch.html#常见功能" class="sidebar-link">常见功能</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/code/python/pytorch.html#earlystop" class="sidebar-link">earlystop</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/code/python/pytorch.html#基础模板" class="sidebar-link">基础模板</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/code/python/pytorch.html#attention-pooling" class="sidebar-link">attention pooling</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/code/python/pytorch.html#损失函数" class="sidebar-link">损失函数</a></li><li class="sidebar-sub-header"><a href="/blog/code/python/pytorch.html#优化器" class="sidebar-link">优化器</a></li><li class="sidebar-sub-header"><a href="/blog/code/python/pytorch.html#避免过拟合" class="sidebar-link">避免过拟合</a></li><li class="sidebar-sub-header"><a href="/blog/code/python/pytorch.html#分布式训练" class="sidebar-link">分布式训练</a></li></ul></li><li><a href="/blog/code/python/pandas.html" class="sidebar-link">pandas</a></li><li><a href="/blog/code/python/matplotlib.html" class="sidebar-link">matplotlib</a></li><li><a href="/blog/code/python/pyecharts.html" class="sidebar-link">pyecharts</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/blog/code/vue/" class="sidebar-heading clickable"><span>vue</span> <span class="arrow right"></span></a> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="pytorch"><a href="#pytorch" class="header-anchor">#</a> pytorch</h1> <h1 id="pytorch-2"><a href="#pytorch-2" class="header-anchor">#</a> pytorch</h1> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> torch
<span class="token keyword">from</span> torch <span class="token keyword">import</span> nn
<span class="token keyword">from</span> torch<span class="token punctuation">.</span>nn <span class="token keyword">import</span> functional <span class="token keyword">as</span> F

<span class="token keyword">from</span> torch<span class="token punctuation">.</span>autograd <span class="token keyword">import</span> Variable
<span class="token keyword">from</span> torch<span class="token punctuation">.</span>nn <span class="token keyword">import</span> utils <span class="token keyword">as</span> nn_utils

<span class="token triple-quoted-string string">&quot;&quot;&quot;指定device&quot;&quot;&quot;</span>
device <span class="token operator">=</span> torch<span class="token punctuation">.</span>device<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;cuda:</span><span class="token interpolation"><span class="token punctuation">{</span>args<span class="token punctuation">.</span>gpu<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span> <span class="token keyword">if</span> torch<span class="token punctuation">.</span>cuda<span class="token punctuation">.</span>is_available<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token string">&quot;cpu&quot;</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;清空显存&quot;&quot;&quot;</span>
torch<span class="token punctuation">.</span>cuda<span class="token punctuation">.</span>empty_cache<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="张量初始化及转换"><a href="#张量初始化及转换" class="header-anchor">#</a> 张量初始化及转换</h2> <p>张量: 多维数组</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token triple-quoted-string string">&quot;&quot;&quot;全为 0 的张量&quot;&quot;&quot;</span>
torch<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span>m<span class="token punctuation">,</span> n<span class="token punctuation">)</span>       <span class="token comment"># m × n 维张量</span>
torch<span class="token punctuation">.</span>zeros_like<span class="token punctuation">(</span><span class="token builtin">input</span><span class="token punctuation">)</span> <span class="token comment"># 和 input 形状一样的</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;全为 1 的张量&quot;&quot;&quot;</span>
torch<span class="token punctuation">.</span>ones<span class="token punctuation">(</span>m<span class="token punctuation">,</span> n<span class="token punctuation">)</span>
torch<span class="token punctuation">.</span>ones_like<span class="token punctuation">(</span><span class="token builtin">input</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;从 start 到 end 的序列&quot;&quot;&quot;</span>
torch<span class="token punctuation">.</span>arrange<span class="token punctuation">(</span>start<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> end<span class="token punctuation">,</span> step<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot; 全为某个值的张量&quot;&quot;&quot;</span>
torch<span class="token punctuation">.</span>full<span class="token punctuation">(</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span>n<span class="token punctuation">)</span><span class="token punctuation">,</span> fill_value<span class="token punctuation">)</span>

<span class="token triple-quoted-string string">&quot;&quot;&quot;随机初始化&quot;&quot;&quot;</span>
torch<span class="token punctuation">.</span>rand<span class="token punctuation">(</span>size<span class="token punctuation">)</span> <span class="token comment"># 每个值为 [0,1) 内均匀分布随机数</span>
torch<span class="token punctuation">.</span>rand_like<span class="token punctuation">(</span><span class="token builtin">input</span><span class="token punctuation">)</span>
torch<span class="token punctuation">.</span>randn<span class="token punctuation">(</span>size<span class="token punctuation">)</span> <span class="token comment"># 每个值为标准正态分布 N(0,1) 内的随机数</span>
torch<span class="token punctuation">.</span>normal<span class="token punctuation">(</span>mean<span class="token punctuation">,</span> std<span class="token punctuation">,</span> out<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span> <span class="token comment"># 返回张量包括从给定参数mean, std 离散正态分布中抽取的随机数, mean/std 可以是张量, 代表每个书华晨宇元素相关的正态分布参数</span>

<span class="token triple-quoted-string string">&quot;&quot;&quot;tensor 2 numpy&quot;&quot;&quot;</span>
tensor<span class="token punctuation">.</span>numpy<span class="token punctuation">(</span><span class="token punctuation">)</span>
tensor<span class="token punctuation">.</span>cpu<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>numpy<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 存储于 GPU 上的张量先转换到 CPU 上</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;numpy 2 tensor&quot;&quot;&quot;</span>
torch<span class="token punctuation">.</span>from_numpy<span class="token punctuation">(</span>array<span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;tensor 2 list&quot;&quot;&quot;</span>
tensor<span class="token punctuation">.</span>tolist<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;list 2 tensor&quot;&quot;&quot;</span>
torch<span class="token punctuation">.</span>Tensor<span class="token punctuation">(</span>mylist<span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;tensor 2 number&quot;&quot;&quot;</span>
tensor<span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token triple-quoted-string string">&quot;&quot;&quot;转移到GPU&quot;&quot;&quot;</span>
tensor<span class="token punctuation">.</span>cuda<span class="token punctuation">(</span><span class="token punctuation">)</span>
tensor<span class="token punctuation">.</span>to<span class="token punctuation">(</span><span class="token string">&quot;cuda&quot;</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;转移到指定GPU&quot;&quot;&quot;</span>
device <span class="token operator">=</span> torch<span class="token punctuation">.</span>device<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;cuda:</span><span class="token interpolation"><span class="token punctuation">{</span>args<span class="token punctuation">.</span>gpu<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span> <span class="token keyword">if</span> torch<span class="token punctuation">.</span>cuda<span class="token punctuation">.</span>is_available<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token string">&quot;cpu&quot;</span><span class="token punctuation">)</span>
tensor<span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span>
tensor<span class="token punctuation">.</span>to<span class="token punctuation">(</span>tensor2<span class="token punctuation">.</span>device<span class="token punctuation">)</span> <span class="token comment"># 转移到 tensor2所在的GPU</span>
</code></pre></div><h2 id="张量基本运算"><a href="#张量基本运算" class="header-anchor">#</a> 张量基本运算</h2> <h3 id="基本运算"><a href="#基本运算" class="header-anchor">#</a> 基本运算</h3> <div class="language-python extra-class"><pre class="language-python"><code><span class="token triple-quoted-string string">&quot;&quot;&quot;加法&quot;&quot;&quot;</span>
tensor <span class="token operator">+</span> tensor
torch<span class="token punctuation">.</span>add<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
torch<span class="token punctuation">.</span>add<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> out<span class="token operator">=</span>x<span class="token punctuation">)</span> <span class="token comment"># x变成加和后的值</span>
x<span class="token punctuation">.</span>add<span class="token punctuation">(</span>y<span class="token punctuation">)</span>
x<span class="token punctuation">.</span>add_<span class="token punctuation">(</span>y<span class="token punctuation">)</span> <span class="token comment"># torch中末尾带 '_' 的方法都是 in-place 的操作</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;除法&quot;&quot;&quot;</span>
torch<span class="token punctuation">.</span>div<span class="token punctuation">(</span>tensor<span class="token punctuation">,</span> tensor<span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;指数&quot;&quot;&quot;</span>
torch<span class="token punctuation">.</span><span class="token builtin">pow</span><span class="token punctuation">(</span>tensor<span class="token punctuation">,</span> exponent<span class="token punctuation">,</span> out<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;开根号&quot;&quot;&quot;</span>
torch<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span>tensor<span class="token punctuation">,</span> out<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;取绝对值&quot;&quot;&quot;</span>
torch<span class="token punctuation">.</span><span class="token builtin">abs</span><span class="token punctuation">(</span>tensor<span class="token punctuation">,</span> ut<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;四舍五入到整数&quot;&quot;&quot;</span>
torch<span class="token punctuation">.</span><span class="token builtin">round</span><span class="token punctuation">(</span>tensor<span class="token punctuation">,</span> out<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;向上取整&quot;&quot;&quot;</span>
torch<span class="token punctuation">.</span>ceil<span class="token punctuation">(</span>tensor<span class="token punctuation">,</span> out<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;刀削函数: 把数据规范在 [min, max] 之间&quot;&quot;&quot;</span>
torch<span class="token punctuation">.</span>clamp<span class="token punctuation">(</span>tensor<span class="token punctuation">,</span> <span class="token builtin">min</span><span class="token punctuation">,</span> <span class="token builtin">max</span><span class="token punctuation">,</span> out<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="乘法进阶-mm-mat"><a href="#乘法进阶-mm-mat" class="header-anchor">#</a> 乘法进阶 mm mat</h3> <div class="language-python extra-class"><pre class="language-python"><code><span class="token triple-quoted-string string">&quot;&quot;&quot;与标量相乘 mul: multiply&quot;&quot;&quot;</span>
tensor <span class="token operator">*</span> <span class="token number">2</span>
torch<span class="token punctuation">.</span>mul<span class="token punctuation">(</span>tensor<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;矩阵与向量 element-wise 逐元素相乘: 每列乘以行向量对应列的值&quot;&quot;&quot;</span>
tensor <span class="token operator">*</span> vector
torch<span class="token punctuation">.</span>mul<span class="token punctuation">(</span>tensor<span class="token punctuation">,</span> vector<span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;矩阵与矩阵 element-wise 逐元素相乘&quot;&quot;&quot;</span>
tensor <span class="token operator">*</span> tensor
torch<span class="token punctuation">.</span>mul<span class="token punctuation">(</span>tensor<span class="token punctuation">,</span> tensor<span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;矩阵与矩阵相乘
mm: matrix multiplication 二维矩阵乘法, 要求两个矩阵满足相乘的条件, 一般只计算两个二维矩阵, 不支持broadcast
bmm: batch matrix multiplication 三维批量矩阵乘法, 不支持broadcast
matmul: matrix product 混合矩阵乘法, 输入为二维时是普通的矩阵乘法; 输入有多维时, 把多出的一维作为batch提出来, 其他部分做矩阵乘法. 支持 broadcast
广播机制 (broadcast): 将较小的数组广播至较大的数组, 使两者形状互相兼容
&quot;&quot;&quot;</span>
tensor @ tensor
torch<span class="token punctuation">.</span>mm<span class="token punctuation">(</span>tensor<span class="token punctuation">,</span> tensor<span class="token punctuation">)</span> <span class="token comment"># 一般只计算两个二维矩阵</span>
torch<span class="token punctuation">.</span>matmul<span class="token punctuation">(</span>tensor<span class="token punctuation">,</span> tensor<span class="token punctuation">)</span>
</code></pre></div><p><code>matmul</code> 介绍: <a href="https://pytorch.org/docs/stable/generated/torch.matmul.html#torch.matmul" target="_blank" rel="noopener noreferrer">https://pytorch.org/docs/stable/generated/torch.matmul.html#torch.matmul<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>例子:</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token triple-quoted-string string">&quot;&quot;&quot;tensor * attention weights
a: representation (batch, seq, hidden) 
b: attention  weights (batch, seq)
&quot;&quot;&quot;</span>
torch<span class="token punctuation">.</span>mul<span class="token punctuation">(</span>a<span class="token punctuation">.</span>permute<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">.</span>permute<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>
a <span class="token operator">*</span> b<span class="token punctuation">.</span>unsqueeze<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>expand<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> a<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="聚合-max-min-mean"><a href="#聚合-max-min-mean" class="header-anchor">#</a> 聚合 max min mean</h3> <h3 id="拼接-切分-cat-stack-chunk-split"><a href="#拼接-切分-cat-stack-chunk-split" class="header-anchor">#</a> 拼接/切分 cat stack chunk split</h3> <div class="language-python extra-class"><pre class="language-python"><code><span class="token triple-quoted-string string">&quot;&quot;&quot;不增维拼接: cat&quot;&quot;&quot;</span>torch<span class="token punctuation">.</span>cat<span class="token punctuation">(</span>tensor_tuple<span class="token punctuation">,</span> dim_cat<span class="token punctuation">)</span><span class="token triple-quoted-string string">&quot;&quot;&quot;增维拼接: stack 可以保留序列信息和矩阵信息&quot;&quot;&quot;</span>torch<span class="token punctuation">.</span>stack<span class="token punctuation">(</span>tensor_tuple<span class="token punctuation">,</span> dim_stack<span class="token punctuation">)</span><span class="token triple-quoted-string string">&quot;&quot;&quot;切分成一定数量: chunk&quot;&quot;&quot;</span>torch<span class="token punctuation">.</span>chunk<span class="token punctuation">(</span>tensor<span class="token punctuation">,</span> chunk_num<span class="token punctuation">,</span> dim_chunk<span class="token punctuation">)</span><span class="token triple-quoted-string string">&quot;&quot;&quot;按列表数目切分: split&quot;&quot;&quot;</span>torch<span class="token punctuation">.</span>split<span class="token punctuation">(</span>tensor<span class="token punctuation">,</span> split_list<span class="token punctuation">,</span> dim<span class="token punctuation">)</span>
</code></pre></div><h3 id="形状转换-squeeze-view-transpose-permute-pad"><a href="#形状转换-squeeze-view-transpose-permute-pad" class="header-anchor">#</a> 形状转换 squeeze view transpose permute pad</h3> <div class="language-python extra-class"><pre class="language-python"><code><span class="token triple-quoted-string string">&quot;&quot;&quot;降维&quot;&quot;&quot;</span>tensor<span class="token punctuation">.</span>squeeze<span class="token punctuation">(</span>dim_num<span class="token punctuation">)</span><span class="token triple-quoted-string string">&quot;&quot;&quot;升维&quot;&quot;&quot;</span>tensor<span class="token punctuation">.</span>unsqueeze<span class="token punctuation">(</span>dim_num<span class="token punctuation">)</span><span class="token triple-quoted-string string">&quot;&quot;&quot;形状变换: 保证总元素个数不变, 要保证张量是连续的&quot;&quot;&quot;</span>tensor<span class="token punctuation">.</span>view<span class="token punctuation">(</span>m<span class="token punctuation">,</span> n<span class="token punctuation">)</span>tensor<span class="token punctuation">.</span>isconuous<span class="token triple-quoted-string string">&quot;&quot;&quot;维度转置: 两个维度相交换&quot;&quot;&quot;</span>tensor<span class="token punctuation">.</span>tanspose<span class="token punctuation">(</span>dim1<span class="token punctuation">,</span> dim2<span class="token punctuation">)</span><span class="token triple-quoted-string string">&quot;&quot;&quot;维度转置: 多个维度相交换, 数量需与张量维度匹配&quot;&quot;&quot;</span>tensor<span class="token punctuation">.</span>permute<span class="token punctuation">(</span>dim1<span class="token punctuation">,</span> dim2<span class="token punctuation">,</span> dim3<span class="token punctuation">)</span><span class="token triple-quoted-string string">&quot;&quot;&quot;用 0 填充&quot;&quot;&quot;</span>F<span class="token punctuation">.</span>pad<span class="token punctuation">(</span>tensor<span class="token punctuation">,</span> pad<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> num<span class="token punctuation">)</span><span class="token punctuation">,</span> mode<span class="token operator">=</span><span class="token string">'constant'</span><span class="token punctuation">,</span> value<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment"># 二维 - 在下面填充num行0</span>
</code></pre></div><p>pad: <a href="https://pytorch.org/docs/stable/generated/torch.nn.functional.pad.html" target="_blank" rel="noopener noreferrer">https://pytorch.org/docs/stable/generated/torch.nn.functional.pad.html<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="常见功能"><a href="#常见功能" class="header-anchor">#</a> 常见功能</h2> <h3 id="earlystop"><a href="#earlystop" class="header-anchor">#</a> earlystop</h3> <h2 id="基础模板"><a href="#基础模板" class="header-anchor">#</a> 基础模板</h2> <h3 id="attention-pooling"><a href="#attention-pooling" class="header-anchor">#</a> attention pooling</h3> <h2 id="损失函数"><a href="#损失函数" class="header-anchor">#</a> 损失函数</h2> <p>（及参数）</p> <h2 id="优化器"><a href="#优化器" class="header-anchor">#</a> 优化器</h2> <h2 id="避免过拟合"><a href="#避免过拟合" class="header-anchor">#</a> 避免过拟合</h2> <h2 id="分布式训练"><a href="#分布式训练" class="header-anchor">#</a> 分布式训练</h2></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog/code/python/packages.html" class="prev">
        packages
      </a></span> <span class="next"><a href="/blog/code/python/pandas.html">
        pandas
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.e19d5aed.js" defer></script><script src="/assets/js/2.a3bd5069.js" defer></script><script src="/assets/js/19.a888442d.js" defer></script>
  </body>
</html>
